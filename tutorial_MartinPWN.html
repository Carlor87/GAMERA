

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Level 5: The PWN model by Martin et al. 2012 &mdash; GAMERA 0.9 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="GAMERA 0.9 documentation" href="index.html"/>
        <link rel="up" title="Tutorial" href="tutorial.html"/>
        <link rel="next" title="Class Documentation" href="classes.html"/>
        <link rel="prev" title="Level 4: Photon Spectrum, Particle Evolution, Almost Everything Variable" href="tutorial_dyn_sc_evo_losses.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> GAMERA
          

          
          </a>

          
            
            
              <div class="version">
                0.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation and Usage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="tutorial.html#spectral-source-modeling">Spectral Source Modeling</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tutorial_static_sc_simple.html">Level 1: Photon Spectrum, Input Particle Distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_static_sc_evo.html">Level 2: Photon Spectrum, Particle Evolution, Static Scenario</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_dyn_sc_evo.html">Level 3: Photon Spectrum, Particle Evolution, Variable Luminosity</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial_dyn_sc_evo_losses.html">Level 4: Photon Spectrum, Particle Evolution, Almost Everything Variable</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Level 5: The PWN model by Martin et al. 2012</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial.html#population-synthesis">Population Synthesis</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="classes.html">Class Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">GAMERA</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
          <li><a href="tutorial.html">Tutorial</a> &raquo;</li>
      
    <li>Level 5: The PWN model by Martin et al. 2012</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/tutorial_MartinPWN.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="level-5-the-pwn-model-by-martin-et-al-2012">
<h1>Level 5: The PWN model by Martin et al. 2012<a class="headerlink" href="#level-5-the-pwn-model-by-martin-et-al-2012" title="Permalink to this headline">Â¶</a></h1>
<p>Now we have learned everything that is needed for writing a real time-dependent
astrophysical source model. In the following, the model by Martin et al.
(Martin J., Torres D. F., &amp; Rea N. 2012, MNRAS 427, 415),
(Torres, D. F., Cillis, A., Martin, J., &amp; de Ona Wilhelmi, E. 2014,
Journal of High Energy Astrophysics, 1, 31).</p>
<p>Again, <code class="docutils literal"><span class="pre">python</span></code>-script and parameter file are located in the
<code class="docutils literal"><span class="pre">docu/tutorial/</span></code> directory.</p>
<p>In principle, the whole model-specific physics is in the function that fills
the parameter lookups, and so changing this function is all that has to be changed.
To that end, we replace the <code class="docutils literal"><span class="pre">GetSpindownStuff</span></code> function from level 4 by</p>
<blockquote>
<div><blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">CalculateTimeDependentStuff</span><span class="p">():</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.e6</span><span class="o">*</span><span class="n">age</span><span class="p">),</span><span class="mi">80</span><span class="p">)</span>
  <span class="n">gammap</span> <span class="o">=</span> <span class="mf">1.3333</span>
  <span class="n">vej</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">10.</span><span class="o">*</span><span class="n">e0</span><span class="o">/</span><span class="p">(</span><span class="mf">3.</span><span class="o">*</span><span class="n">mej</span><span class="p">))</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">((</span><span class="mf">6.</span><span class="o">/</span><span class="p">(</span><span class="mf">15.</span><span class="o">*</span><span class="p">(</span><span class="n">gammap</span><span class="o">-</span><span class="mf">1.</span><span class="p">)))</span><span class="o">+</span><span class="mf">289.</span><span class="o">/</span><span class="mf">240.</span><span class="p">,</span><span class="o">-</span><span class="mf">0.2</span><span class="p">);</span>

  <span class="n">lum</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">etab</span><span class="p">)</span><span class="o">*</span><span class="n">lum0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">t</span><span class="o">/</span><span class="n">tc</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">*</span><span class="p">(</span><span class="n">brind</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">brind</span><span class="o">-</span><span class="mf">1.</span><span class="p">))</span>
  <span class="n">emax</span> <span class="o">=</span> <span class="mf">3.</span><span class="o">*</span><span class="n">eps</span><span class="o">*</span><span class="n">gamerapy</span><span class="o">.</span><span class="n">el_charge</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">etab</span><span class="o">*</span><span class="n">lum</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">-</span><span class="n">etab</span><span class="p">)</span><span class="o">*</span><span class="n">gamerapy</span><span class="o">.</span><span class="n">c_speed</span><span class="p">))</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">lum0</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">gamerapy</span><span class="o">.</span><span class="n">yr_to_sec</span><span class="o">/</span><span class="n">e0</span><span class="p">)</span><span class="o">**</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">vej</span><span class="o">*</span><span class="n">t</span><span class="o">*</span><span class="n">gamerapy</span><span class="o">.</span><span class="n">yr_to_sec</span>
  <span class="n">v</span> <span class="o">=</span> <span class="mf">1.2</span><span class="o">*</span><span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="n">gamerapy</span><span class="o">.</span><span class="n">yr_to_sec</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gamerapy</span><span class="o">.</span><span class="n">yr_to_sec</span><span class="o">*</span><span class="n">etab</span><span class="o">*</span><span class="mf">6.</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span> <span class="p">((</span><span class="n">lum</span> <span class="o">*</span> <span class="n">r</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">cumsum</span><span class="p">())))</span>

  <span class="n">lum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">lum</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
  <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
  <span class="n">emax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">emax</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
  <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

  <span class="k">return</span> <span class="n">lum</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">emax</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">v</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Due to calculation speed reasons, the maximum particle energy is currently
capped to 10 PeV if you call the grid solver (i.e. in the case of time-dependent
energy losses).</p>
</div>
</div></blockquote>
<ul class="simple">
<li>these additional commands have to be used in order to get the Synchtroton-Self-Compton (SSC)
component and to set the source radius and extension velocity parameter lookups:</li>
</ul>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">fp</span><span class="o">.</span><span class="n">SetRadiusLookup</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">fp</span><span class="o">.</span><span class="n">SetVelocityLookup</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="n">fr</span><span class="o">.</span><span class="n">SetSSCTargetPhotons</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">GetRadius</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">In this example, the SSC target field is <em>not</em> used for calculating the energy
losses. To remove this caveat you have to iterate in time and pass the
SSC radiation field to the particles object in each step.</p>
</div>
<p>The calculation will take a couple of minutes because the B-field strength and
maximum electron energies are insane at times earlier than several hundreds of
years</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If the computation is slow, there are several ways to compromise.</p>
<p><strong>1. Reduce the number of energy bins</strong></p>
<blockquote>
<div><ul class="simple">
<li>(see tutorial level 4 for an explanation)</li>
</ul>
</div></blockquote>
<p><strong>2. Use the</strong> <code class="docutils literal"><span class="pre">SetCriticalMinEnergyForGridSolver</span></code> <strong>Particle class method:</strong></p>
<blockquote>
<div><ul class="simple">
<li>The grid solver automatically determines the starting time of the
iteration <code class="docutils literal"><span class="pre">tmin</span></code>. Particles injected before <code class="docutils literal"><span class="pre">tmin</span></code> are treated as
being injected as a single blob.
This blob of particles will slide down in energy over time and end up
at some energy <code class="docutils literal"><span class="pre">E</span></code> after <code class="docutils literal"><span class="pre">t=age</span></code>. Now, the grid solver automatically
choses <code class="docutils literal"><span class="pre">tmin</span></code>
as the starting time so that the blob ends up at a desired energy <code class="docutils literal"><span class="pre">Ed</span></code> after
<code class="docutils literal"><span class="pre">t=age</span></code>. The default is <code class="docutils literal"><span class="pre">Ed=1.e-3</span> <span class="pre">erg</span></code>, but you can set a manual
value like <code class="docutils literal"><span class="pre">fp.SetCriticalMinEnergyForGridSolver(1.e-2)</span></code> which would
set <code class="docutils literal"><span class="pre">Ed=1.e-2</span> <span class="pre">erg</span></code>. As a result, <code class="docutils literal"><span class="pre">tmin</span></code> becomes larger, and in systems
where the B-field decreases with time, your electron energy losses at the beginning of
the evolution are smaller which in turn increases the computational speed
(see tutorial level 4).
The same effect is achievable by setting a high value of Emin, e.g.
<code class="docutils literal"><span class="pre">fp.SetEmin(1.e-2)</span></code>. Choose this options when you can live with this
bump - this is typically true when you are only interested in VHE
emission and even a high bump in electrons doesn&#8217;t matter as you are looking
at the emission from TeV particles.</li>
</ul>
</div></blockquote>
<p><strong>3. Decrease the number in your lookups to a minimum</strong></p>
<blockquote>
<div><ul class="simple">
<li>This makes the binary search in the lookups faster!</li>
</ul>
</div></blockquote>
<p><strong>4. Appoximate with constant losses</strong></p>
<blockquote class="last">
<div><ul class="simple">
<li>If the time-changes in the loss-governing parameters (i.e. B-field,
ambient density, source radius and extension speed) are slow, you could
approximate with a model where these values are static. In other words,
approximate with something like the model you got to know in level 3.</li>
</ul>
</div></blockquote>
</div>
</div></blockquote>
<p>Et voila:</p>
<a class="reference internal image-reference" href="_images/TutorialLevel5.jpg"><img alt="_images/TutorialLevel5.jpg" class="align-center" src="_images/TutorialLevel5.jpg" style="width: 700.0px; height: 3500.0px;" /></a>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="classes.html" class="btn btn-neutral float-right" title="Class Documentation" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial_dyn_sc_evo_losses.html" class="btn btn-neutral" title="Level 4: Photon Spectrum, Particle Evolution, Almost Everything Variable" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Joachim Hahn.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.9',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>